# crypto-hw
#cryptography homework

from gmpy2 import add, isqrt, sub, div, mul, isqrt_rem, mpz, powmod

N1 = mpz("179769313486231590772930519078902473361797697894230657273430081157732675805505620686985379449212982959585501387537164015710139858647833778606925583497541085196591615128057575940752635007475935288710823649949940771895617054361149474865046711015101563940680527540071584560878577663743040086340742855278549092581")

N2 = mpz("648455842808071669662824265346772278726343720706976263060439070378797308618081116462714015276061417569195587321840254520655424906719892428844841839353281972988531310511738648965962582821502504990264452100885281673303711142296421027840289307657458645233683357077834689715838646088239640236866252211790085787877")

N3 = mpz("720062263747350425279564435525583738338084451473999841826653057981916355690188337790423408664187663938485175264994017897083524079135686877441155132015188279331812309091996246361896836573643119174094961348524639707885238799396839230364676670221627018353299443241192173812729276147530748597302192751375739387929")

ciphertext4 = mpz("22096451867410381776306561134883418017410069787892831071731839143676135600120538004282329650473509424343946219751512256465839967942889460764542040581564748988013734864120452325229320176487916666402997509188729971690526083222067771600019329260870009579993724077458967773697817571267229951148662959627934791540")

def runPart1(N):
    A = isqrt(N)
    A = add(A, 1) #couldn't find default ceil function
    x = isqrt(sub(mul(A,A), N))
    p = sub(A, x)
    q = add(A, x)

    return p, q

def runPart2(N):
    A = isqrt(N)
    maxVal = add(isqrt(N), 2**20)
    p = 0
    q = 0
    
    while mul(p, q) != N and A <= maxVal:
        A = add(A, 1)
        x = isqrt(sub(mul(A,A), N))
        p = sub(A, x)
        q = add(A, x)
    
    return p, q
        
def runPart3(N):
    A2 = add(isqrt(mul(24, N)), 1)
    x2 = isqrt(sub(mul(A2, A2), mul(24, N)))
    p  = div(sub(A2, x2), 6)
    q  = div(add(A2, x2), 4)
    
    return p, q

def runPart4(N, (p, q)):
    e = 65537
    totient = mul(sub(p,1),sub(q,1))
    d = powmod(e, -1, totient)
    m = powmod(ciphertext4, d, N)

    import re
    m = re.search('00(\w+)', hex(m))

    return m.group(0).decode("hex") 

def main():
    print "Solution 1: ", runPart1(N1)[0]
    print "Solution 2: ", runPart2(N2)[0]
    print "Solution 3: ", runPart3(N3)[0]
    print "Solution 4: ", runPart4(N1, runPart1(N1))
if __name__ == "__main__":    
    main()
